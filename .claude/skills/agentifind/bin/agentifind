#!/usr/bin/env bash
#
# agentifind - Codebase Intelligence for AI Agents
#
# Extracts code structure and validates code quality to produce
# a codebase.json that AI agents can use for navigation.
#
# Usage: agentifind <command> [options]
#
# Commands:
#   sync   - Extract code structure and validate
#   status - Check if codebase.json is stale
#

set -euo pipefail

# Get the directory where this script is located (resolving symlinks)
SOURCE="${BASH_SOURCE[0]}"
while [ -L "$SOURCE" ]; do
    DIR="$(cd -P "$(dirname "$SOURCE")" && pwd)"
    SOURCE="$(readlink "$SOURCE")"
    [[ $SOURCE != /* ]] && SOURCE="$DIR/$SOURCE"
done
SCRIPT_DIR="$(cd -P "$(dirname "$SOURCE")" && pwd)"
PACKAGE_ROOT="$(dirname "$SCRIPT_DIR")"

# Check for Node.js
if ! command -v node &>/dev/null; then
    echo "[ERROR] Node.js is required but not installed."
    exit 1
fi

# Run the main CLI - pass all arguments through
exec node "$PACKAGE_ROOT/dist/index.js" "$@"
